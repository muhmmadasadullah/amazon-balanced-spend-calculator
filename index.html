<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Amazon Balanced Spend Calculator</title>
    <!-- General description -->
    <meta name="description" content="Calculate the optimal Amazon PPC ad spend to reach your target TACOS based on your organic sales, current ACOS and spend. Use sliders and inputs to explore scenarios, view interactive charts and export your data." />
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Amazon Balanced Spend Calculator" />
    <meta property="og:description" content="Determine the ideal Amazon advertising spend to hit your TACOS goals. Interactive charts, dark mode, exportable data and more." />
    <meta property="og:url" content="" />
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:title" content="Amazon Balanced Spend Calculator" />
    <meta property="twitter:description" content="Interactive tool to calculate your balanced ad spend on Amazon to achieve target TACOS." />
    <!-- CDN libraries -->
        <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js" crossorigin></script>
        <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
        <!-- PropTypes is required by Recharts UMD build -->
        <script src="https://cdn.jsdelivr.net/npm/prop-types@15.8.1/prop-types.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/recharts@2.8.0/umd/Recharts.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons UMD build -->
    <script src="https://cdn.jsdelivr.net/npm/lucide-react@latest/dist/umd/lucide-react.js"></script>
    <!-- Babel for in-browser JSX transformation -->
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <style>
        /* Custom tooltip display for info icons */
        .info-group:hover .info-tooltip {
            opacity: 1;
        }
        .info-tooltip {
            transition: opacity 0.2s ease;
        }
    </style>
</head>
<body class="min-h-screen">
    <div id="root"></div>
    <script type="text/babel" data-presets="react">
    // Destructure required components from global libraries
    const { useState, useEffect } = React;
    const {
      AreaChart,
      Area,
      XAxis,
      YAxis,
      CartesianGrid,
      Tooltip,
      ResponsiveContainer,
      ReferenceLine,
    } = Recharts;
    // Import only the Info icon from LucideReact. Some other icons are not present
    // in the UMD build and cause React error #130 (invalid element type). We
    // define fall‑back dummy components for any icons we reference but do not
    // import here. Each dummy component returns null so it renders nothing.
    const { Info } = LucideReact;
    const Download = () => null;
    const Moon = () => null;
    const Sun = () => null;
    const RotateCcw = () => null;
    const Share2 = () => null;
    const TrendingUp = () => null;
    const TrendingDown = () => null;

        // Global error handler to surface runtime errors on the page. This attaches a listener
        // to the window's `error` event and injects a visible message when something goes wrong.
        window.addEventListener('error', function(event) {
          // Create a <pre> element to display the error details in red text.
          const errorDiv = document.createElement('pre');
          errorDiv.style.color = 'red';
          errorDiv.style.backgroundColor = '#ffeeee';
          errorDiv.style.padding = '1rem';
          errorDiv.style.margin = '1rem';
          errorDiv.style.border = '1px solid #ffaaaa';
          errorDiv.style.whiteSpace = 'pre-wrap';
          errorDiv.textContent = 'Error: ' + event.message + '\n' + (event.filename || '') + ':' + event.lineno;
          document.body.appendChild(errorDiv);
        });

    const App = () => {
      // Theme state
      const [isDark, setIsDark] = useState(false);
      // User inputs
      const [targetTacos, setTargetTacos] = useState(15);
      const [ppcAcos, setPpcAcos] = useState(35);
      const [organicSales, setOrganicSales] = useState(50000);
      const [organicSalesDisplay, setOrganicSalesDisplay] = useState('50,000');
      const [currentSpend, setCurrentSpend] = useState(15000);
      const [currentSpendDisplay, setCurrentSpendDisplay] = useState('15,000');
      // Calculated values
      const [balanceSpendMultiplier, setBalanceSpendMultiplier] = useState(null);
      const [balancedSpend, setBalancedSpend] = useState(null);
      const [chartData, setChartData] = useState([]);
      const [yAxisDomain, setYAxisDomain] = useState(['auto', 'auto']);
      // Preset arrays
      const tacosPresets = [10, 12, 15, 20];
      const acosPresets = [25, 30, 35, 40];
      const scenarioPresets = {
        Conservative: { tacos: 12, acos: 30 },
        Balanced: { tacos: 15, acos: 35 },
        Aggressive: { tacos: 20, acos: 40 },
      };
      // Utility functions
      const formatNumberWithCommas = (value) => {
        if (!value) return '';
        return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      };
      const removeCommas = (value) => value.replace(/,/g, '');
      // Handlers for numeric text inputs
      const handleOrganicSalesChange = (e) => {
        const rawValue = removeCommas(e.target.value);
        if (rawValue === '' || /^\d+$/.test(rawValue)) {
          setOrganicSales(rawValue === '' ? 0 : parseInt(rawValue));
          setOrganicSalesDisplay(rawValue === '' ? '' : formatNumberWithCommas(rawValue));
        }
      };
      const handleCurrentSpendChange = (e) => {
        const rawValue = removeCommas(e.target.value);
        if (rawValue === '' || /^\d+$/.test(rawValue)) {
          setCurrentSpend(rawValue === '' ? 0 : parseInt(rawValue));
          setCurrentSpendDisplay(rawValue === '' ? '' : formatNumberWithCommas(rawValue));
        }
      };
      // Compute current TACOS
      const calculateCurrentTacos = () => {
        if (organicSales > 0 && ppcAcos > 0) {
          const ppcSales = currentSpend / (ppcAcos / 100);
          const totalSales = organicSales + ppcSales;
          return (currentSpend / totalSales) * 100;
        }
        return 0;
      };
      // Button callbacks
      const handleReset = () => {
        setTargetTacos(15);
        setPpcAcos(35);
        setOrganicSales(50000);
        setOrganicSalesDisplay('50,000');
        setCurrentSpend(15000);
        setCurrentSpendDisplay('15,000');
      };
      const handleShare = () => {
        const text =
          'Amazon Balanced Spend Analysis - Target TACOS: ' +
          targetTacos +
          '%, PPC ACOS: ' +
          ppcAcos +
          '%, Organic Sales: $' +
          organicSales.toLocaleString() +
          ', Current Spend: $' +
          currentSpend.toLocaleString();
        if (navigator.clipboard) {
          navigator.clipboard
            .writeText(text)
            .then(() => {
              alert('Analysis details copied to clipboard!');
            })
            .catch(() => {
              alert('Failed to copy to clipboard');
            });
        }
      };
      const handleDarkMode = () => {
        setIsDark(!isDark);
      };
      const applyScenario = (scenario) => {
        const preset = scenarioPresets[scenario];
        setTargetTacos(preset.tacos);
        setPpcAcos(preset.acos);
      };
      const exportToExcel = () => {
        const csvContent =
          'Amazon Balanced Spend Calculator Export\n' +
          'Target TACOS,' +
          targetTacos +
          '%\n' +
          'PPC ACOS,' +
          ppcAcos +
          '%\n' +
          'Organic Sales,$' +
          organicSales.toLocaleString() +
          '\n' +
          'Current Spend,$' +
          currentSpend.toLocaleString() +
          '\n' +
          'Balanced Spend,' +
          (balancedSpend === 'Unlimited'
            ? 'Unlimited'
            : '$' + (balancedSpend?.toLocaleString() || '0'));
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download =
          'amazon-balanced-spend-' + new Date().toISOString().split('T')[0] + '.csv';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      };
      // Info tooltip component using manual hover styles
      const InfoTooltip = ({ children }) => (
        <div className="relative info-group inline-block align-middle">
          <Info size={14} className="text-gray-400 hover:text-gray-600 cursor-help" />
          <div className="info-tooltip absolute left-0 top-6 bg-gray-900 text-white text-xs rounded-lg p-2 w-64 opacity-0 z-10 pointer-events-none shadow-lg">
            {children}
          </div>
        </div>
      );
      // Preset chip component
      const PresetChip = ({ value, current, onClick, suffix = '%' }) => (
        <button
          onClick={() => onClick(value)}
          className={`px-3 py-1 rounded-full text-sm font-medium transition-all duration-200 ${
            current === value
              ? 'bg-blue-500 text-white shadow-sm'
              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
          }`}
        >
          {value}
          {suffix}
        </button>
      );
      // Delta badge component
      const DeltaBadge = ({ value }) => {
        if (value === null || value === undefined) return <span className="text-gray-500">N/A</span>;
        const isPositive = value >= 0;
        const Icon = isPositive ? TrendingUp : TrendingDown;
        return (
          <div
            className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium ${
              isPositive
                ? 'bg-green-50 text-green-700 border border-green-200'
                : 'bg-red-50 text-red-700 border border-red-200'
            }`}
          >
            <Icon size={12} />
            {isPositive ? '+' : '-'}${Math.abs(value).toLocaleString()}
          </div>
        );
      };
      // Main calculation effect
      useEffect(() => {
        const targetTacosNum = parseFloat(targetTacos);
        const ppcAcosNum = parseFloat(ppcAcos);
        const organicSalesNum = parseFloat(organicSales);
        let multiplier = null;
        let calculatedSpend = null;
        if (ppcAcosNum === 0 || targetTacosNum >= ppcAcosNum) {
          setBalanceSpendMultiplier('Unlimited');
          setBalancedSpend('Unlimited');
          setYAxisDomain(['auto', 'auto']);
        } else {
          const targetTacosDecimal = targetTacosNum / 100;
          const ppcAcosDecimal = ppcAcosNum / 100;
          multiplier = (targetTacosDecimal * ppcAcosDecimal) / (ppcAcosDecimal - targetTacosDecimal);
          setBalanceSpendMultiplier(multiplier.toFixed(4));
          calculatedSpend = Math.round(multiplier * organicSalesNum);
          setBalancedSpend(calculatedSpend);
          const spendValues = [calculatedSpend, currentSpend].filter((val) => val > 0);
          if (spendValues.length > 0) {
            const minSpend = Math.min(...spendValues);
            const maxSpend = Math.max(...spendValues);
            const buffer = Math.max(1000, (maxSpend - minSpend) * 0.3);
            const yMin = Math.max(0, minSpend - buffer);
            const yMax = maxSpend + buffer;
            setYAxisDomain([yMin, yMax]);
          } else {
            setYAxisDomain(['auto', 'auto']);
          }
        }
        // Chart data generation
        const rangeStart = Math.max(1, targetTacosNum - 5);
        const rangeEnd = targetTacosNum + 5;
        const tacosColumns = [];
        for (let i = rangeStart; i <= rangeEnd; i += 1) {
          tacosColumns.push(i);
        }
        if (!tacosColumns.includes(targetTacosNum)) {
          tacosColumns.push(targetTacosNum);
        }
        tacosColumns.sort((a, b) => a - b);
        const data = tacosColumns.map((tacos) => {
          let spend = null;
          const ppcAcosDecimal = ppcAcosNum / 100;
          const tacosDecimal = tacos / 100;
          if (ppcAcosNum > tacos && ppcAcosNum !== 0) {
            const currentMultiplier = (tacosDecimal * ppcAcosDecimal) / (ppcAcosDecimal - tacosDecimal);
            spend = Math.round(currentMultiplier * organicSalesNum);
          }
          return {
            tacos: `${tacos}%`,
            'Balanced Spend': spend,
          };
        });
        setChartData(data);
      }, [targetTacos, ppcAcos, organicSales, currentSpend]);
      const currentTacos = calculateCurrentTacos();
      const adjustment = balancedSpend !== 'Unlimited' && balancedSpend !== null ? balancedSpend - currentSpend : null;
      return (
        <div
          className={`transition-colors duration-300 ${
            isDark ? 'dark bg-gray-900' : 'bg-gradient-to-br from-blue-50 via-white to-indigo-50'
          }`}
        >
          {/* Top Navigation Bar */}
          <div className="sticky top-0 z-20 backdrop-blur-md bg-white/80 dark:bg-gray-900/80 border-b border-gray-200 dark:border-gray-700">
            <div className="max-w-6xl mx-auto px-6 py-4">
              <div className="flex items-center justify-between">
                <div>
                  <h1 className="text-2xl font-bold text-gray-900 dark:text-white">Amazon Balanced Spend</h1>
                  <p className="text-sm text-gray-600 dark:text-gray-400">Calculate optimal ad spend to hit your TACOS target</p>
                </div>
                <div className="flex items-center gap-3">
                  <button type="button" onClick={handleReset} className="flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors border border-gray-300">
                    <RotateCcw size={16} /> Reset
                  </button>
                  <button type="button" onClick={handleShare} className="flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors border border-gray-300">
                    <Share2 size={16} /> Share
                  </button>
                  <button type="button" onClick={handleDarkMode} className="p-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    {isDark ? <Sun size={16} /> : <Moon size={16} />}
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div className="max-w-6xl mx-auto p-6">
            {/* Scenario Presets */}
            <div className="mb-6">
              <div className="flex items-center gap-2 mb-3">
                <h3 className="text-sm font-semibold text-gray-700 dark:text-gray-300">Quick Scenarios</h3>
              </div>
              <div className="flex flex-wrap gap-2">
                {Object.keys(scenarioPresets).map((scenario) => (
                  <button key={scenario} type="button" onClick={() => applyScenario(scenario)} className="px-4 py-2 rounded-xl text-sm font-medium bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-200 shadow-sm">
                    {scenario}
                  </button>
                ))}
              </div>
            </div>
            <div className="grid lg:grid-cols-2 gap-6">
              {/* Left Column */}
              <div className="space-y-6">
                {/* Input Controls */}
                <div className="rounded-2xl bg-white/80 dark:bg-gray-800/80 backdrop-blur border border-gray-200 dark:border-gray-700 p-6 shadow-[0_6px_24px_rgba(0,0,0,0.06)]">
                  {/* Targets Section */}
                  <div className="mb-6">
                    <div className="flex items-center gap-2 mb-4">
                      <h3 className="text-lg font-semibold text-gray-900 dark:text-white">Targets</h3>
                      <InfoTooltip>Set your target TACOS and current PPC ACOS performance</InfoTooltip>
                    </div>
                    {/* Target TACOS */}
                    <div className="mb-4">
                      <div className="flex items-center justify-between mb-2">
                        <label className="text-sm font-medium text-gray-700 dark:text-gray-300">Target TACOS</label>
                        <div className="relative">
                          <input type="number" value={targetTacos} onChange={(e) => setTargetTacos(parseFloat(e.target.value) || 0)} className="w-20 px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white tabular-nums" />
                          <span className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 text-sm">%</span>
                        </div>
                      </div>
                      <input type="range" min="5" max="30" step="1" value={targetTacos} onChange={(e) => setTargetTacos(parseFloat(e.target.value))} className="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer" />
                      <div className="flex gap-2 mt-2">
                        {tacosPresets.map((preset) => (
                          <PresetChip key={preset} value={preset} current={targetTacos} onClick={setTargetTacos} />
                        ))}
                      </div>
                    </div>
                    {/* PPC ACOS */}
                    <div>
                      <div className="flex items-center justify-between mb-2">
                        <label className="text-sm font-medium text-gray-700 dark:text-gray-300">PPC ACOS</label>
                        <div className="relative">
                          <input type="number" value={ppcAcos} onChange={(e) => setPpcAcos(parseFloat(e.target.value) || 0)} className="w-20 px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white tabular-nums" />
                          <span className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 text-sm">%</span>
                        </div>
                      </div>
                      <input type="range" min="10" max="60" step="1" value={ppcAcos} onChange={(e) => setPpcAcos(parseFloat(e.target.value))} className="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer" />
                      <div className="flex gap-2 mt-2">
                        {acosPresets.map((preset) => (
                          <PresetChip key={preset} value={preset} current={ppcAcos} onClick={setPpcAcos} />
                        ))}
                      </div>
                    </div>
                  </div>
                  <hr className="border-gray-200 dark:border-gray-700 my-6" />
                  {/* Current Section */}
                  <div>
                    <div className="flex items-center gap-2 mb-4">
                      <h3 className="text-lg font-semibold text-gray-900 dark:text-white">Current Performance</h3>
                      <InfoTooltip>Enter your current organic sales and ad spend</InfoTooltip>
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Organic Sales</label>
                        <div className="relative">
                          <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
                          <input type="text" value={organicSalesDisplay} onChange={handleOrganicSalesChange} className="w-full pl-8 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white tabular-nums focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="50,000" />
                        </div>
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Current Spend</label>
                        <div className="relative">
                          <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
                          <input type="text" value={currentSpendDisplay} onChange={handleCurrentSpendChange} className="w-full pl-8 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white tabular-nums focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="15,000" />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                {/* Metric Cards */}
                <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                  <div className="rounded-2xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 p-5 shadow-[0_6px_24px_rgba(0,0,0,0.06)] transition-all duration-200">
                    <div className="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Balanced Spend</div>
                    <div className="text-3xl font-extrabold tracking-tight tabular-nums text-blue-600 dark:text-blue-400 mb-1">
                      {balancedSpend === 'Unlimited' ? 'Unlimited' : `$${balancedSpend?.toLocaleString() || '0'}`}
                    </div>
                    <div className="text-xs text-gray-500 dark:text-gray-400">Based on current ACOS</div>
                  </div>
                  <div className="rounded-2xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 p-5 shadow-[0_6px_24px_rgba(0,0,0,0.06)] transition-all duration-200">
                    <div className="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Adjustment</div>
                    <div className="mb-1"><DeltaBadge value={adjustment} /></div>
                    <div className="text-xs text-gray-500 dark:text-gray-400">vs. current spend</div>
                  </div>
                  <div className="rounded-2xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 p-5 shadow-[0_6px_24px_rgba(0,0,0,0.06)] transition-all duration-200">
                    <div className="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Current TACOS</div>
                    <div className="text-3xl font-extrabold tracking-tight tabular-nums text-gray-900 dark:text-white mb-1">{currentTacos.toFixed(1)}%</div>
                    <div className="text-xs text-gray-500 dark:text-gray-400">Total advertising cost</div>
                  </div>
                </div>
                {/* Auto-Calculated Sales Breakdown */}
                <div className="rounded-2xl bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-900/20 dark:to-blue-900/20 border border-indigo-200 dark:border-indigo-800 p-5">
                  <div className="flex items-center gap-2 mb-4">
                    <h3 className="text-lg font-semibold text-indigo-900 dark:text-indigo-300">Auto-Calculated Sales Breakdown</h3>
                    <InfoTooltip>These values are calculated from your inputs - we derive PPC sales and total sales automatically</InfoTooltip>
                  </div>
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                    <div className="bg-white/60 dark:bg-gray-800/60 p-3 rounded-lg">
                      <div className="text-gray-600 dark:text-gray-400 mb-1">Current PPC Sales</div>
                      <div className="font-bold text-lg tabular-nums text-indigo-700 dark:text-indigo-300">${ppcAcos > 0 ? Math.round(currentSpend / (ppcAcos / 100)).toLocaleString() : '0'}</div>
                      <div className="text-xs text-gray-500 dark:text-gray-400">Spend ÷ ACOS</div>
                    </div>
                    <div className="bg-white/60 dark:bg-gray-800/60 p-3 rounded-lg">
                      <div className="text-gray-600 dark:text-gray-400 mb-1">Current Total Sales</div>
                      <div className="font-bold text-lg tabular-nums text-indigo-700 dark:text-indigo-300">${ppcAcos > 0 ? (organicSales + Math.round(currentSpend / (ppcAcos / 100))).toLocaleString() : organicSales.toLocaleString()}</div>
                      <div className="text-xs text-gray-500 dark:text-gray-400">Organic + PPC</div>
                    </div>
                    <div className="bg-white/60 dark:bg-gray-800/60 p-3 rounded-lg">
                      <div className="text-gray-600 dark:text-gray-400 mb-1">Target PPC Sales</div>
                      <div className="font-bold text-lg tabular-nums text-green-700 dark:text-green-300">{balancedSpend === 'Unlimited' || ppcAcos === 0 ? 'Unlimited' : `$${Math.round(balancedSpend / (ppcAcos / 100)).toLocaleString()}`}</div>
                      <div className="text-xs text-gray-500 dark:text-gray-400">Target Spend ÷ ACOS</div>
                    </div>
                    <div className="bg-white/60 dark:bg-gray-800/60 p-3 rounded-lg">
                      <div className="text-gray-600 dark:text-gray-400 mb-1">Target Total Sales</div>
                      <div className="font-bold text-lg tabular-nums text-green-700 dark:text-green-300">{balancedSpend === 'Unlimited' || ppcAcos === 0 ? 'Unlimited' : `$${(organicSales + Math.round(balancedSpend / (ppcAcos / 100))).toLocaleString()}`}</div>
                      <div className="text-xs text-gray-500 dark:text-gray-400">Organic + Target PPC</div>
                    </div>
                  </div>
                  <div className="mt-4 p-3 bg-white/40 dark:bg-gray-800/40 rounded-lg">
                    <p className="text-sm text-indigo-800 dark:text-indigo-300"><strong>How this works:</strong> We calculate PPC sales by dividing ad spend by ACOS (since ACOS = Spend ÷ PPC Sales). Total sales = Organic sales + PPC sales. This lets us determine what spend achieves your target TACOS without needing you to input sales figures directly.</p>
                  </div>
                </div>
                {/* Invalid State Warning */}
                {(ppcAcos <= targetTacos || ppcAcos === 0) && (
                  <div className="rounded-2xl bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 p-5">
                    <h4 className="font-semibold text-amber-800 dark:text-amber-300 mb-2">Why is spend \"Unlimited\"?</h4>
                    <p className="text-sm text-amber-700 dark:text-amber-400">When Target TACOS ≥ PPC ACOS, the math breaks down. You'd need infinite spend to hit that target. Try lowering your Target TACOS below your PPC ACOS.</p>
                  </div>
                )}
              </div>
              {/* Right Column */}
              <div className="rounded-2xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 p-6 shadow-[0_6px_24px_rgba(0,0,0,0.06)]">
                <div className="flex items-center justify-between mb-4">
                  <h2 className="text-xl font-bold text-gray-900 dark:text-white">Spend vs. TACOS Curve</h2>
                  <button type="button" onClick={exportToExcel} className="flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors border border-blue-200 dark:border-blue-800"><Download size={16} /> Export Data</button>
                </div>
                <div className="grid grid-cols-3 gap-4 mb-6 text-sm">
                  <div className="flex items-center justify-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                    <div className="w-4 h-0.5 bg-blue-500 mr-2"></div>
                    <span className="text-blue-700 dark:text-blue-300 font-medium">Spend Curve</span>
                  </div>
                  <div className="flex items-center justify-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                    <div className="w-4 h-0.5 bg-green-500 border-dashed border-t-2 border-green-500 mr-2"></div>
                    <span className="text-green-700 dark:text-green-300 font-medium">Target: {balancedSpend === 'Unlimited' ? '∞' : Math.round((balancedSpend || 0) / 1000) + 'k'}</span>
                  </div>
                  <div className="flex items-center justify-center p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
                    <div className="w-4 h-0.5 bg-red-500 border-dashed border-t-2 border-red-500 mr-2"></div>
                    <span className="text-red-700 dark:text-red-300 font-medium">Current: {Math.round(currentSpend / 1000)}k</span>
                  </div>
                </div>
                <div className="h-80 mb-4">
                  <ResponsiveContainer width="100%" height="100%">
                    <AreaChart data={chartData} margin={{ top: 20, right: 30, left: 50, bottom: 40 }}>
                      <defs>
                        <linearGradient id="spendGradient" x1="0" y1="0" x2="0" y2="1">
                          <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.15} />
                          <stop offset="95%" stopColor="#3b82f6" stopOpacity={0} />
                        </linearGradient>
                      </defs>
                      <CartesianGrid strokeDasharray="3 3" stroke={isDark ? '#374151' : '#e5e7eb'} opacity={0.5} />
                      <XAxis dataKey="tacos" label={{ value: 'Target TACOS', position: 'insideBottom', offset: -20, style: { textAnchor: 'middle', fill: isDark ? '#d1d5db' : '#6b7280' } }} tick={{ fontSize: 12, fill: isDark ? '#d1d5db' : '#6b7280' }} />
                      <YAxis domain={yAxisDomain} label={{ value: 'Required Spend ($)', angle: -90, position: 'insideLeft', style: { textAnchor: 'middle', fill: isDark ? '#d1d5db' : '#6b7280' } }} tickFormatter={(tick) => `$${Math.round(tick / 1000)}k`} tick={{ fontSize: 12, fill: isDark ? '#d1d5db' : '#6b7280' }} />
                      <Tooltip formatter={(value) => [`$${Math.round(value).toLocaleString()}`, 'Required Spend']} labelFormatter={(label) => `Target TACOS: ${label}`} contentStyle={{ backgroundColor: isDark ? '#1f2937' : '#ffffff', border: `1px solid ${isDark ? '#374151' : '#e5e7eb'}`, borderRadius: '8px', fontSize: '13px', color: isDark ? '#f9fafb' : '#111827', boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)' }} />
                      <Area type="monotone" dataKey="Balanced Spend" stroke="#3b82f6" strokeWidth={3} fill="url(#spendGradient)" dot={{ fill: '#3b82f6', strokeWidth: 2, r: 5 }} activeDot={{ r: 7, stroke: '#3b82f6', strokeWidth: 3, fill: '#ffffff' }} />
                      {balancedSpend !== 'Unlimited' && balancedSpend !== null && (
                        <ReferenceLine y={balancedSpend} stroke="#22c55e" strokeDasharray="8 4" strokeWidth={2} />
                      )}
                      <ReferenceLine y={currentSpend} stroke="#ef4444" strokeDasharray="8 4" strokeWidth={2} />
                      <ReferenceLine x={`${targetTacos}%`} stroke="#8b5cf6" strokeDasharray="4 4" strokeWidth={2} strokeOpacity={0.7} />
                    </AreaChart>
                  </ResponsiveContainer>
                </div>
                <div className="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                    <div className="text-center">
                      <div className="font-semibold text-gray-800 dark:text-gray-200">Exponential Growth</div>
                      <div className="text-gray-600 dark:text-gray-400">Higher TACOS targets require exponentially more spend</div>
                    </div>
                    <div className="text-center">
                      <div className="font-semibold text-gray-800 dark:text-gray-200">Your Sweet Spot</div>
                      <div className="text-gray-600 dark:text-gray-400">Purple line shows your {targetTacos}% TACOS target</div>
                    </div>
                    <div className="text-center">
                      <div className="font-semibold text-gray-800 dark:text-gray-200">Gap Analysis</div>
                      <div className="text-gray-600 dark:text-gray-400">Distance between red and green lines shows adjustment needed</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {/* Formula Breakdown */}
            <div className="mt-8 rounded-2xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 p-6 shadow-[0_6px_24px_rgba(0,0,0,0.06)]">
              <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6">How It Works</h2>
              <div className="space-y-6">
                <div className="bg-blue-50 dark:bg-blue-900/20 p-5 rounded-xl border border-blue-200 dark:border-blue-800">
                  <h3 className="text-lg font-bold text-blue-700 dark:text-blue-300 mb-3">Step 1: Understanding the Key Terms</h3>
                  <div className="grid md:grid-cols-2 gap-4 text-sm">
                    <div>
                      <p className="font-semibold text-gray-700 dark:text-gray-300">TACOS (Total Advertising Cost of Sales):</p>
                      <p className="text-gray-600 dark:text-gray-400">Ad Spend ÷ Total Sales (Organic + PPC Sales)</p>
                      <p className="text-gray-600 dark:text-gray-400 italic">Shows overall advertising efficiency</p>
                    </div>
                    <div>
                      <p className="font-semibold text-gray-700 dark:text-gray-300">ACOS (Advertising Cost of Sales):</p>
                      <p className="text-gray-600 dark:text-gray-400">Ad Spend ÷ PPC Sales Only</p>
                      <p className="text-gray-600 dark:text-gray-400 italic">Shows direct ad campaign efficiency</p>
                    </div>
                  </div>
                </div>
                <div className="bg-green-50 dark:bg-green-900/20 p-5 rounded-xl border border-green-200 dark:border-green-800">
                  <h3 className="text-lg font-bold text-green-700 dark:text-green-300 mb-3">Step 2: The Logic Behind the Formula</h3>
                  <div className="text-sm text-gray-700 dark:text-gray-300 space-y-2">
                    <p>• When you spend on ads, you generate PPC sales AND boost organic sales</p>
                    <p>• TACOS considers both effects, while ACOS only looks at direct PPC results</p>
                    <p>• To hit your target TACOS, you need to balance ad spend against total sales impact</p>
                    <p>• The multiplier tells us: "For every $1 of organic sales, spend $X on ads"</p>
                  </div>
                </div>
                <div className="bg-purple-50 dark:bg-purple-900/20 p-5 rounded-xl border border-purple-200 dark:border-purple-800">
                  <h3 className="text-lg font-bold text-purple-700 dark:text-purple-300 mb-3">Step 3: Breaking Down the Formula</h3>
                  <div className="space-y-3 text-sm">
                    <div className="bg-white dark:bg-gray-700 p-3 rounded border-l-4 border-purple-400">
                      <p className="font-semibold text-gray-700 dark:text-gray-300">Formula Part 1: Find the Multiplier</p>
                      <p className="font-mono text-purple-600 dark:text-purple-400">Multiplier = (Target TACOS × PPC ACOS) ÷ (PPC ACOS - Target TACOS)</p>
                      <p className="text-gray-600 dark:text-gray-400 mt-1">This calculates how much to spend per dollar of organic sales</p>
                    </div>
                    <div className="bg-white dark:bg-gray-700 p-3 rounded border-l-4 border-purple-400">
                      <p className="font-semibold text-gray-700 dark:text-gray-300">Formula Part 2: Calculate Total Spend</p>
                      <p className="font-mono text-purple-600 dark:text-purple-400">Balanced Spend = Multiplier × Organic Sales</p>
                      <p className="text-gray-600 dark:text-gray-400 mt-1">Apply the multiplier to your actual organic sales</p>
                    </div>
                  </div>
                </div>
                <div className="bg-white dark:bg-gray-700 p-5 rounded-xl shadow-sm border border-gray-200 dark:border-gray-600">
                  <h3 className="text-lg font-bold text-gray-700 dark:text-gray-300 mb-3">Step 4: Your Current Calculation</h3>
                  <div className="space-y-4 text-sm">
                    <div className="bg-gray-50 dark:bg-gray-800 p-3 rounded">
                      <p className="font-semibold text-gray-700 dark:text-gray-300">Step 4a: Calculate the Multiplier</p>
                      <p className="font-mono text-gray-800 dark:text-gray-200 mt-1">({targetTacos}% × {ppcAcos}%) ÷ ({ppcAcos}% - {targetTacos}%)</p>
                      <p className="font-mono text-gray-800 dark:text-gray-200">= ({((targetTacos * ppcAcos) / 100).toFixed(2)}) ÷ ({ppcAcos - targetTacos}% )</p>
                      <p className="font-mono text-gray-800 dark:text-gray-200">= ({((targetTacos * ppcAcos) / 100).toFixed(2)}) ÷ ({(ppcAcos - targetTacos) / 100})</p>
                      <p className="font-mono text-gray-800 dark:text-gray-200">= <strong>{balanceSpendMultiplier !== 'Unlimited' ? parseFloat(balanceSpendMultiplier).toFixed(4) : 'Unlimited'}</strong></p>
                    </div>
                    <div className="bg-blue-100 dark:bg-blue-900/40 p-3 rounded border-l-4 border-blue-400">
                      <p className="font-semibold text-blue-700 dark:text-blue-300">💡 What this multiplier means:</p>
                      <p className="text-gray-700 dark:text-gray-300 mt-1">The multiplier <strong>{balanceSpendMultiplier !== 'Unlimited' ? parseFloat(balanceSpendMultiplier).toFixed(4) : 'Unlimited'}</strong> tells us: <em>"For every $1 of organic sales, we should spend {balanceSpendMultiplier !== 'Unlimited' ? parseFloat(balanceSpendMultiplier).toFixed(2) : 'Unlimited'} on advertising to hit our target TACOS of {targetTacos}%"</em></p>
                      <p className="text-gray-600 dark:text-gray-400 text-xs mt-2">In other words: Organic Sales × {balanceSpendMultiplier !== 'Unlimited' ? parseFloat(balanceSpendMultiplier).toFixed(4) : 'Unlimited'} = Optimal Ad Spend</p>
                    </div>
                    <div className="bg-gray-50 dark:bg-gray-800 p-3 rounded">
                      <p className="font-semibold text-gray-700 dark:text-gray-300">Step 4b: Apply the Multiplier to Your Organic Sales</p>
                      <p className="text-gray-600 dark:text-gray-400 mb-2">Now we take our multiplier and apply it to your actual organic sales:</p>
                      <p className="font-mono text-gray-800 dark:text-gray-200">{balanceSpendMultiplier !== 'Unlimited' ? parseFloat(balanceSpendMultiplier).toFixed(4) : 'Unlimited'} × ${organicSales.toLocaleString()}</p>
                      <p className="font-mono text-gray-800 dark:text-gray-200">= <strong>{balancedSpend === 'Unlimited' ? 'Unlimited' : `$${balancedSpend?.toLocaleString() || '0'}`}</strong></p>
                    </div>
                    <div className="bg-green-100 dark:bg-green-900/40 p-3 rounded border-l-4 border-green-400">
                      <p className="font-semibold text-green-700 dark:text-green-300">🎯 Final Result:</p>
                      <p className="text-gray-700 dark:text-gray-300">To achieve your target TACOS of <strong>{targetTacos}%</strong> with your current organic sales of <strong>${organicSales.toLocaleString()}</strong> and PPC ACOS of <strong>{ppcAcos}%</strong>, you should spend approximately <strong>{balancedSpend === 'Unlimited' ? 'Unlimited' : `$${balancedSpend?.toLocaleString() || '0'}`}</strong> on advertising.</p>
                      {balancedSpend !== 'Unlimited' && balancedSpend !== null && (
                        <p className="text-gray-600 dark:text-gray-400 text-sm mt-2">Your current spend is ${currentSpend.toLocaleString()}, so you need to {balancedSpend > currentSpend ? 'increase' : 'decrease'} by ${Math.abs(balancedSpend - currentSpend).toLocaleString()}.</p>
                      )}
                    </div>
                  </div>
                </div>
                <hr className="border-gray-200 dark:border-gray-600" />
                <div className="bg-yellow-50 dark:bg-yellow-900/20 p-5 rounded-xl border-l-4 border-yellow-400">
                  <p className="text-lg text-gray-700 dark:text-gray-300"><strong className="text-yellow-700 dark:text-yellow-300">💡 Key Insight:</strong> This gives you a directional target for ad spend — based on your current ACOS, organic sales, and where you want your TACOS to be. It's not perfect math, but it's a smart starting point to guide your strategy.</p>
                </div>
              </div>
            </div>
            {/* Footer */}
            <div className="mt-8 text-center">
              <p className="text-sm text-gray-500 dark:text-gray-400 mb-2">Directional model—validate with weekly cohorts and real performance data.</p>
              <p className="text-sm text-gray-400 dark:text-gray-500">Made by Asad with ❤️</p>
            </div>
          </div>
        </div>
      );
    };
    // Mount the app
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
